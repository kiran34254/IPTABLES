1Ô∏è‚É£ Backup current iptables & ip6tables rules
Run as root (preferably from console access):
mkdir -p /etc/iptables
Backup IPv4 rules
iptables-save > /etc/iptables/iptables.rules
Backup IPv6 rules
ip6tables-save > /etc/iptables/ip6tables.rules
Verify backup
ls -l /etc/iptables/
You should see:
iptables.rules
ip6tables.rules
2Ô∏è‚É£ Restore rules manually (test first)
‚ö†Ô∏è Always test restore before systemd
iptables-restore < /etc/iptables/iptables.rules
ip6tables-restore < /etc/iptables/ip6tables.rules
Check:
iptables -L -n
ip6tables -L -n
If SSH stays alive ‚Üí good üëç
3Ô∏è‚É£ Create systemd service for iptables restore
Create service file
vi /etc/systemd/system/iptables-restore.service
Paste this content
[Unit]
Description=Restore iptables and ip6tables rules
DefaultDependencies=no
Before=network-pre.target
Wants=network-pre.target

[Service]
Type=oneshot
ExecStart=/usr/sbin/iptables-restore /etc/iptables/iptables.rules
ExecStart=/usr/sbin/ip6tables-restore /etc/iptables/ip6tables.rules
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
4Ô∏è‚É£ Reload systemd and enable service
systemctl daemon-reexec
systemctl daemon-reload
systemctl enable iptables-restore.service
Start service manually (test)
systemctl start iptables-restore.service
Check status
systemctl status iptables-restore.service
